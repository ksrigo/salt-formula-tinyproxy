{%- from "tinyproxy/map.jinja" import service with context -%}
User {{ service.user }}
Group {{ service.group }}
Listen {{ service.bind.address }}
Port {{ service.bind.port }}
Timeout {{ service.get('timeout', '900') }}
LogLevel {{ service.log.level|capitalize }}
{%- if service.log.get('syslog') %}
Syslog on
{%- else %}
Logfile "{{ service.log.file }}"
{%- endif %}
PidFile "/var/run/tinyproxy/tinyproxy.pid"
XTinyproxy Yes
{%- if service.upstream is defined %}
Upstream {{ service.upstream }}
{%- endif %}
MaxClients {{ service.get('max_clients', '550') }}
MinSpareServers {{ service.get('minspareservers', '15') }}
MaxSpareServers {{ service.get('maxspareservers', '20') }}
StartServers {{ service.get('startservers', '15') }}
MaxRequestsPerChild {{ service.get('maxrequestsperchild', '0') }}
{%- for net in service.get('allow', []) %}
Allow {{ net }}
{%- endfor %}
{%- for net in service.get('deny', []) %}
Deny {{ net }}
{%- endfor %}
DisableViaHeader Yes
{%- for anonymous in service.get('anonymous', ['Host', 'Authorization', 'Cookie']) %}
Anonymous "{{ anonymous }}"
{%- endfor %}
{%- for port in service.get('connect_ports', []) %}
ConnectPort {{ port }}
{%- endfor %}
{#-
vim: syntax=jinja
-#}
